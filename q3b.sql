WITH PILL_BUYER (BUYER_ZIP, SUMMME) AS (SELECT BUYER_ZIP, CAST(SUM(MME) AS INT) AS SUMMME FROM CSE532.DEA_NY GROUP BY BUYER_ZIP) SELECT BUYER_ZIP AS ZIP, SUMMME / ZIPS.POP AS MMENORM, RANK() OVER (ORDER BY SUMMME / ZIPS.POP DESC) AS RANK FROM PILL_BUYER INNER JOIN CSE532.ZIPPOP AS ZIPS ON BUYER_ZIP = ZIPS.ZIP WHERE ZIPS.POP IS NOT NULL AND ZIPS.POP > 0 LIMIT 10;
